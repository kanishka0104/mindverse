<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Your profile, preferences, and progress tracking">
  <title>Profile - MindVerse</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="nav-bar">
    <div class="nav-container">
      <a href="index.html" class="nav-item">
        <span class="nav-icon">ğŸ </span>
        <span>Home</span>
      </a>
      <a href="activities.html" class="nav-item">
        <span class="nav-icon">âœ¨</span>
        <span>Activities</span>
      </a>
      <a href="skills.html" class="nav-item">
        <span class="nav-icon">ğŸ¯</span>
        <span>Skills</span>
      </a>
      <a href="profile.html" class="nav-item active">
        <span class="nav-icon">ğŸ‘¤</span>
        <span>Profile</span>
      </a>
      <a href="settings.html" class="nav-item">
        <span class="nav-icon">âš™ï¸</span>
        <span>Settings</span>
      </a>
    </div>
  </nav>

  <!-- Page Content -->
  <div class="page-wrapper">
    <div class="page-header">
      <h1>Your Profile</h1>
      <p class="profile-email" style="color: var(--color-text-light); margin-top: 0.5rem;"></p>
    </div>

    <div class="container">
      <!-- User Account Card -->
      <div class="card">
        <div class="profile-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
          <div>
            <h2 style="margin: 0;">Welcome Back!</h2>
            <p style="color: var(--color-text-light); margin: 0.5rem 0 0 0;" class="profile-email"></p>
          </div>
          <button class="btn btn-outline" onclick="handleLogout()" style="color: var(--color-secondary);">
            ğŸšª Logout
          </button>
        </div>
      </div>

      <!-- Streak & Motivation -->
      <div class="card text-center">
        <div style="font-size: 3rem; margin-bottom: var(--spacing-sm);">ğŸ”¥</div>
        <h2 style="color: var(--color-primary); margin-bottom: var(--spacing-xs);">
          <span id="streakDays">-</span> Day Streak
        </h2>
        <p style="color: var(--color-text-light);" id="streakMessage">
          Loading your progress...
        </p>
      </div>

      <!-- User Preferences -->
      <div class="card">
        <h2 class="card-title">Preferences</h2>
        <p style="color: var(--color-text-light); margin-bottom: var(--spacing-md);">
          Help us personalize your experience
        </p>

        <div class="form-group">
          <label class="form-label" for="focusArea">What do you want to focus on?</label>
          <select id="focusArea" class="form-select">
            <option value="">Select your focus...</option>
            <option value="reduce_anxiety">Reduce anxiety</option>
            <option value="feel_less_sad">Feel less sad</option>
            <option value="sleep_better">Sleep better</option>
            <option value="build_confidence">Build confidence</option>
            <option value="general">General wellbeing</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label" for="preferredTime">When do you usually use the app?</label>
          <select id="preferredTime" class="form-select">
            <option value="">Select a time...</option>
            <option value="morning">Morning</option>
            <option value="afternoon">Afternoon</option>
            <option value="evening">Evening</option>
            <option value="any">Anytime</option>
          </select>
        </div>

        <button class="btn btn-primary btn-block" id="savePreferencesBtn">
          ğŸ’¾ Save Preferences
        </button>
      </div>

      <!-- Progress Stats -->
      <div class="card">
        <h2 class="card-title">Your Progress</h2>
        <p style="color: var(--color-text-light); margin-bottom: var(--spacing-md);">
          Last 7 days
        </p>

        <div class="stats-grid">
          <div class="stat-card">
            <span class="stat-value" id="statMoodEntries">-</span>
            <span class="stat-label">Mood Check-ins</span>
          </div>

          <div class="stat-card">
            <span class="stat-value" id="statJournalEntries">-</span>
            <span class="stat-label">Journal Entries</span>
          </div>

          <div class="stat-card">
            <span class="stat-value" id="statBreathingSessions">-</span>
            <span class="stat-label">Breathing Sessions</span>
          </div>

          <div class="stat-card">
            <span class="stat-value" id="statActivities">-</span>
            <span class="stat-label">Activities Done</span>
          </div>
        </div>

        <!-- Weekly Activity -->
        <div class="mt-lg">
          <h3 style="font-size: var(--font-size-base); margin-bottom: var(--spacing-sm);">
            Days Active This Week
          </h3>
          <div id="weeklyActivity" style="display: flex; gap: var(--spacing-xs); justify-content: space-around; flex-wrap: wrap;">
            <!-- Will be filled dynamically -->
          </div>
        </div>
      </div>

      <!-- Visual Progress Charts -->
      <div class="card">
        <h2 class="card-title">ğŸ“Š Progress Charts</h2>
        <p style="color: var(--color-text-light); margin-bottom: var(--spacing-lg);">
          Visualize your mental health journey over time
        </p>

        <!-- Mood Trend Chart -->
        <div class="chart-section">
          <h3 class="chart-title">Mood Trends (Last 30 Days)</h3>
          <div class="chart-container">
            <canvas id="moodTrendChart"></canvas>
          </div>
        </div>

        <!-- Activity Frequency Chart -->
        <div class="chart-section">
          <h3 class="chart-title">Activity Summary (Last 7 Days)</h3>
          <div class="chart-container">
            <canvas id="activityChart"></canvas>
          </div>
        </div>

        <!-- Sleep Pattern Chart -->
        <div class="chart-section">
          <h3 class="chart-title">Sleep Duration (Last 7 Days)</h3>
          <div class="chart-container">
            <canvas id="sleepChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Progress Rewind -->
      <div class="card">
        <h2 class="card-title">â®ï¸ Progress Rewind</h2>
        <p style="color: var(--color-text-light); margin-bottom: var(--spacing-lg);">
          Look how far you've come! Compare your current state to the past.
        </p>

        <div class="rewind-selector">
          <button class="rewind-btn active" data-period="30" onclick="loadProgressRewind(30)">
            1 Month Ago
          </button>
          <button class="rewind-btn" data-period="90" onclick="loadProgressRewind(90)">
            3 Months Ago
          </button>
          <button class="rewind-btn" data-period="180" onclick="loadProgressRewind(180)">
            6 Months Ago
          </button>
          <button class="rewind-btn" data-period="365" onclick="loadProgressRewind(365)">
            1 Year Ago
          </button>
        </div>

        <div id="progressRewindContainer" class="mt-lg">
          <p class="text-center" style="color: var(--color-text-light);">
            Loading your progress...
          </p>
        </div>
      </div>

      <!-- Favorite Affirmations -->
      <div class="card">
        <h2 class="card-title">ğŸ’ Favorite Affirmations</h2>
        <div id="favoritesContainer">
          <p class="text-center" style="color: var(--color-text-light);">
            Loading your favorites...
          </p>
        </div>
      </div>

      <!-- Positive Memory Bank -->
      <div class="card">
        <h2 class="card-title">ğŸŒŸ Positive Memory Bank</h2>
        <p style="color: var(--color-text-light); margin-bottom: var(--spacing-md);">
          Save and revisit your happy moments, achievements, and positive experiences
        </p>

        <!-- Add Memory Button -->
        <button class="btn btn-primary" onclick="openMemoryModal()">
          â• Add New Memory
        </button>

        <!-- Memory Display -->
        <div class="mt-lg" id="memoriesContainer">
          <p class="text-center" style="color: var(--color-text-light);">
            Loading your memories...
          </p>
        </div>
      </div>

      <!-- Personal Safety Plan Button -->
      <div class="card">
        <h2 class="card-title">ğŸ›¡ï¸ Personal Safety Plan</h2>
        <p style="color: var(--color-text-light); margin-bottom: var(--spacing-md);">
          Create and manage your personalized safety plan for difficult moments
        </p>
        <button class="btn btn-primary" onclick="openSafetyPlanModal()">
          ğŸ“‹ Open Safety Plan
        </button>
      </div>

      <!-- Data Management -->
      <div class="card">
        <h3 class="card-title">Data & Privacy</h3>
        <p style="color: var(--color-text-light); margin-bottom: var(--spacing-md);">
          Your data is stored locally in your browser and in Firebase.
        </p>
        <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
          <button class="btn btn-outline btn-sm" onclick="showDataInfo()">
            â„¹ï¸ About Your Data
          </button>
        </div>
      </div>

    </div>
  </div>

  <!-- Add Memory Modal -->
  <div class="modal" id="memoryModal">
    <div class="modal-content">
      <button class="modal-close" onclick="MindVerse.closeModal(document.getElementById('memoryModal'))">
        âœ•
      </button>
      <h2>ğŸŒŸ Add Positive Memory</h2>
      <p style="color: var(--color-text-light); margin-bottom: var(--spacing-lg);">
        Capture a happy moment or achievement to revisit later
      </p>

      <div class="form-group">
        <label class="form-label" for="memoryTitle">Title</label>
        <input type="text" id="memoryTitle" class="form-input" placeholder="e.g., Beach day with family">
      </div>

      <div class="form-group">
        <label class="form-label" for="memoryDescription">Description</label>
        <textarea id="memoryDescription" class="form-textarea" placeholder="What made this moment special?" rows="4"></textarea>
      </div>

      <div class="form-group">
        <label class="form-label" for="memoryDate">Date</label>
        <input type="date" id="memoryDate" class="form-input">
      </div>

      <div class="form-group">
        <label class="form-label" for="memoryImageUrl">Image URL (Optional)</label>
        <input type="url" id="memoryImageUrl" class="form-input" placeholder="https://example.com/image.jpg">
      </div>

      <button class="btn btn-primary btn-block" onclick="saveMemory()">
        ğŸ’¾ Save Memory
      </button>
    </div>
  </div>

  <!-- Personal Safety Plan Modal -->
  <div class="modal" id="safetyPlanModal">
    <div class="modal-content modal-large">
      <button class="modal-close" onclick="MindVerse.closeModal(document.getElementById('safetyPlanModal'))">
        âœ•
      </button>
      <h2>ğŸ›¡ï¸ Personal Safety Plan</h2>
      <p style="color: var(--color-text-light); margin-bottom: var(--spacing-lg);">
        Your personalized plan for difficult moments
      </p>

      <!-- Warning Signs -->
      <div class="safety-section">
        <h3 class="safety-section-title">âš ï¸ My Warning Signs</h3>
        <p class="safety-section-desc">What thoughts, feelings, or behaviors indicate I might need support?</p>
        <div id="warningSignsList" class="safety-list">
          <!-- Dynamic content -->
        </div>
        <div class="form-group">
          <input type="text" id="warningSignInput" class="form-input" placeholder="e.g., Isolating from friends, trouble sleeping...">
          <button class="btn btn-secondary btn-sm" onclick="addWarningSigns()">+ Add Warning Sign</button>
        </div>
      </div>

      <!-- Coping Strategies -->
      <div class="safety-section">
        <h3 class="safety-section-title">ğŸ’ª My Coping Strategies</h3>
        <p class="safety-section-desc">Things I can do on my own to feel better</p>
        <div id="copingStrategiesList" class="safety-list">
          <!-- Dynamic content -->
        </div>
        <div class="form-group">
          <input type="text" id="copingStrategyInput" class="form-input" placeholder="e.g., Deep breathing, going for a walk, listening to music...">
          <button class="btn btn-secondary btn-sm" onclick="addCopingStrategy()">+ Add Strategy</button>
        </div>
      </div>

      <!-- Reasons for Living -->
      <div class="safety-section">
        <h3 class="safety-section-title">â¤ï¸ My Reasons for Living</h3>
        <p class="safety-section-desc">People, things, or goals that are important to me</p>
        <div id="reasonsForLivingList" class="safety-list">
          <!-- Dynamic content -->
        </div>
        <div class="form-group">
          <input type="text" id="reasonForLivingInput" class="form-input" placeholder="e.g., My family, my pet, my goals...">
          <button class="btn btn-secondary btn-sm" onclick="addReasonForLiving()">+ Add Reason</button>
        </div>
      </div>

      <!-- Support Contacts -->
      <div class="safety-section">
        <h3 class="safety-section-title">ğŸ“ My Support Network</h3>
        <p class="safety-section-desc">People I can reach out to when I need help</p>
        <div id="supportContactsList" class="safety-contacts-grid">
          <!-- Dynamic content -->
        </div>
        <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-sm);">
          <input type="text" id="contactNameInput" class="form-input" placeholder="Name">
          <input type="tel" id="contactPhoneInput" class="form-input" placeholder="Phone number">
        </div>
        <button class="btn btn-secondary btn-sm" onclick="addSupportContact()">+ Add Contact</button>
      </div>

      <!-- Professional Help -->
      <div class="safety-section">
        <h3 class="safety-section-title">ğŸ¥ Professional Support</h3>
        <p class="safety-section-desc">Healthcare providers and mental health professionals</p>
        <div id="professionalContactsList" class="safety-contacts-grid">
          <!-- Dynamic content -->
        </div>
        <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-sm);">
          <input type="text" id="professionalNameInput" class="form-input" placeholder="Name/Service">
          <input type="tel" id="professionalPhoneInput" class="form-input" placeholder="Phone number">
        </div>
        <button class="btn btn-secondary btn-sm" onclick="addProfessionalContact()">+ Add Professional</button>
      </div>

      <!-- Crisis Resources -->
      <div class="safety-section">
        <h3 class="safety-section-title">ğŸ†˜ Crisis Resources</h3>
        <div class="crisis-resources">
          <div class="crisis-card">
            <div class="crisis-card-header">
              <strong>988 Suicide & Crisis Lifeline</strong>
              <a href="tel:988" class="btn btn-danger btn-sm">Call 988</a>
            </div>
            <p>24/7 free and confidential support for people in distress</p>
          </div>
          <div class="crisis-card">
            <div class="crisis-card-header">
              <strong>Crisis Text Line</strong>
              <a href="sms:741741" class="btn btn-danger btn-sm">Text HOME to 741741</a>
            </div>
            <p>Free, 24/7 crisis support via text message</p>
          </div>
          <div class="crisis-card">
            <div class="crisis-card-header">
              <strong>Emergency Services</strong>
              <a href="tel:911" class="btn btn-danger btn-sm">Call 911</a>
            </div>
            <p>For immediate life-threatening emergencies</p>
          </div>
        </div>
      </div>

      <!-- Safe Environment -->
      <div class="safety-section">
        <h3 class="safety-section-title">ğŸ  Making My Environment Safer</h3>
        <p class="safety-section-desc">Steps I can take to reduce access to means of self-harm</p>
        <div id="safeEnvironmentList" class="safety-list">
          <!-- Dynamic content -->
        </div>
        <div class="form-group">
          <input type="text" id="safeEnvironmentInput" class="form-input" placeholder="e.g., Remove harmful items, stay with someone...">
          <button class="btn btn-secondary btn-sm" onclick="addSafeEnvironmentStep()">+ Add Step</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Data Info Modal -->
  <div class="modal" id="dataModal">
    <div class="modal-content">
      <button class="modal-close" onclick="MindVerse.closeModal(document.getElementById('dataModal'))">
        âœ•
      </button>
      <h2>About Your Data</h2>
      <p>MindVerse stores your data in two places:</p>
      <ol style="line-height: 2; margin: var(--spacing-md) 0;">
        <li><strong>Your Browser (localStorage):</strong> Your user ID is stored locally on this device.</li>
        <li><strong>Firebase (Cloud Database):</strong> Your mood entries, journal entries, activity logs, 
        and preferences are stored in Firebase Firestore.</li>
      </ol>
      <p><strong>User ID:</strong> <code id="userIdDisplay" style="background: var(--color-background); padding: 4px 8px; border-radius: 4px;">-</code></p>
      <p style="margin-top: var(--spacing-md);">
        <strong>Important:</strong> If you clear your browser data, you'll lose access to your entries 
        unless you note down your user ID. This app does not currently support account recovery.
      </p>
      <div class="alert alert-info" style="margin-top: var(--spacing-md);">
        To use this app with real data, you need to configure Firebase with your own project credentials 
        in <code>firebase-config.js</code>.
      </div>
    </div>
  </div>

  <!-- Chart.js for visualizations -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <!-- App Scripts -->
  <script src="firebase-config.js"></script>
  <script src="common.js"></script>
  <script src="profile.js"></script>
</body>
</html>
